<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebXR Portal</title>
    <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/ar.js/1.7.2/aframe-ar.min.js"></script>
</head>
<body>
    <a-scene 
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; debugUIEnabled: false">

        <!-- Portal -->
        <a-entity 
            id="portalFrame"
            geometry="primitive: plane; height: 3; width: 2;" 
            material="shader: flat; src: #portalImage;" 
            position="0 1.5 -5"
            arjs-anchor="type: fixed;">
        </a-entity>

        <!-- Invisible Collider -->
        <a-entity 
            id="portalCollider"
            geometry="primitive: box; height: 3; width: 2; depth: 0.5;"
            position="0 1.5 -5"
            material="opacity: 0; transparent: true;"
            class="clickable">
        </a-entity>

        <!-- 360 Image -->
        <a-assets>
            <img id="portalImage" src="https://raw.githubusercontent.com/talkats/webxr_portal/main/2025-01-02%2016%2009%2001.png">
            <img id="skyImage" src="https://raw.githubusercontent.com/talkats/webxr_portal/main/20220512_140701_490.jpg">
        </a-assets>

        <!-- Camera -->
        <a-camera 
            position="0 1.6 0"
            look-controls
            wasd-controls>
        </a-camera>
    </a-scene>

    <script>
        // Portal Interaction Logic
        AFRAME.registerComponent('portal-interaction', {
            init: function () {
                const portalCollider = document.querySelector('#portalCollider');
                const sky = document.querySelector('a-sky');
                const skyImage = document.querySelector('#skyImage');

                portalCollider.addEventListener('click', () => {
                    // Replace the default sky with the 360-degree image
                    sky.setAttribute('src', skyImage.getAttribute('src'));

                    // Optionally hide the portal after transition
                    document.querySelector('#portalFrame').setAttribute('visible', false);
                });
            }
        });

        // Attach the portal-interaction component to the portalCollider
        document.querySelector('#portalCollider').setAttribute('portal-interaction', '');
    </script>
</body>
</html>
